# iot4i-shield-toolkit
An IBM streams shield development toolkit which contains a set of operators and helper function that can help quickly develop shields for IBM IoT for insurance service. The toolkit provides the following:

1. source/sink operators that abstract the details of connecting to IBM IoT platform.
2. source/sink operators that abstract the details of connecting to IBM message hub service.
3. CheckActivation operator which can be used to connect with IoT4i API and verify whether the shield is activated or not for a particular user. 
4. Enforce and validate the hazards generated by shield jobs.

### Structure

This toolkit is divided into two stages:

### Prepare Events Stage:

This is the stage where the events are prepare for the shield jobs. The following operators are part of this stage:

**Primitive Operators**:
 
  [CheckActivationOp](./impl/java/src/com/ibm/iot4i/events/common/CheckActivationOp.java):
 
 A java primitive operator to check if the user has activated his shield or not. If the user didn't active his shield, the events will be filtered out. The operator requires the following input params:
 
 `apiURL`,  `apiToken`, `shieldId` and `tenantId` which will be all provided by IoT4i APi when the job is submitted.
 
 **SPL Operators**:
 
1. [Source](./com.ibm.iot4i.events.IoTP/Source.spl)
  
  A source operator that abstract the details of connecting to IBM Message HUB. This operator has no input and generate an output with type `stream<rstring key, rstring message>`. 
  
2. [AnnotatedSource](./com.ibm.iot4i.events.MH/AnnotatedSource.spl)
  
  A source operator that listen to the annotated events which are generated by the transformer job. This operator uses the Source operator internally but listens to different topic and make sure the userId is added to the events. 
 
3. [CheckActivation](./com.ibm.iot4i.events.MH/CheckActivation.spl)
  
  An operator that receives transformed events and check filter events based on the [CheckActivationOp](./impl/java/src/com/ibm/iot4i/events/common/CheckActivationOp.java).
  

There are also similar operators for IBM IoT platform.

### Submit Hazards Stage

In this stage, the hazard generated by the shield jobs are prepared for submission either to an IoTP sink, MH sink or to an Action sink. 

**SPL Operators**:

1. [PrepareHazards](./com.ibm.iot4i.hazards.common/PrepareHazards.spl)

An operator that prepare the hazard for sinks. It parse the hazard to string, adds shieldId and make sure that the userId exists. 

2. [Sink](./com.ibm.iot4i.hazards.MH/Sink.spl)

An operator that receives hazards and publish them to MH.

3. [SubmitHazards](./com.ibm.iot4i.hazards.MH/SubmitHazards.spl)

An operator that receives hazards, prepare them, then calls the MH sink. 


There are also similar operators] for IBM IoT platform.


## Build

```
cd com.ibm.iot4i
../gradlew build
```

## Release
```
./gradlew release
```

**NOTE:** The release will be available in the `build/release/output` folder. 


## Test

```
cd com.ibm.iot4i
../gradlew tests
```


